<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <link rel="icon" type="image/png" sizes="32x32" href="./assets/images/favicon-32x32.png">
  
  <title>Frontend Mentor | Results summary component</title>

  <!-- Feel free to remove these styles or customise in your own stylesheet  -->
  <link rel="stylesheet" href="style.css">





</head>
<body>
  <div id="summary-container">
  </div>


  <script>
    // 爪专转  砖爪 转 拽专 拽
    // 驻拽爪 砖专转 转 -localStorage
    async function saveImageToLocalStorage(src, key) {
      try {
        const response = await fetch(src);
        const blob = await response.blob();
        const reader = new FileReader();
        
        reader.onloadend = () => {
          localStorage.setItem(key, reader.result);
        };
        
        reader.readAsDataURL(blob);
      } catch (error) {
        console.error('Error saving image:', error);
      }
    }

    // 驻拽爪 拽转 转 -localStorage  砖专转
    function getImageSource(src, storageKey) {
      const storedImage = localStorage.getItem(storageKey);
      return storedImage || src;
    }

    function createCategoryElement(category, iconSrc, titleColor) {
      const categoryDiv = document.createElement('div');
      categoryDiv.className = 'category';
      categoryDiv.style.color = titleColor;
      
      const icon = document.createElement('img');
      const storageKey = `icon_${category.toLowerCase()}`;
      icon.src = getImageSource(iconSrc, storageKey);
      icon.alt = category;
      
      // 砖专 转 转 -localStorage    拽转
      if (!localStorage.getItem(storageKey)) {
        saveImageToLocalStorage(iconSrc, storageKey);
      }
      
      categoryDiv.appendChild(icon);
      categoryDiv.appendChild(document.createTextNode(category));
      
      return categoryDiv;
    }

    // 爪专转  砖爪 转 爪
    function createScoreElement(score) {
      const scoreDiv = document.createElement('div');
      scoreDiv.className = 'score';
      scoreDiv.innerHTML = `
        <span class="actual-score">${score}</span>
        <span class="score-separator"> / </span>
        <span class="max-score">100</span>
      `;
      return scoreDiv;
    }

    // 爪专转 砖专 砖 砖 转爪
    function createResultItem(item) {
      const div = document.createElement('div');
      div.className = `summary-item ${item.category.toLowerCase()}`;
      
      div.appendChild(createCategoryElement(item.category, item.icon, item.title));
      div.appendChild(createScoreElement(item.score));
      
      return div;
    }

    // 爪转 注转 砖
    function showError(message) {
      const errorDiv = document.createElement('div');
      errorDiv.style.color = 'red';
      errorDiv.style.padding = '20px';
      errorDiv.textContent = `砖: ${message}`;
      document.body.appendChild(errorDiv);
    }

    // 砖 爪 爪注
    function calculateAverageScore(data) {
      const totalScore = data.reduce((sum, item) => sum + item.score, 0);
      const averageScore = (totalScore / (data.length * 100)) * 100;
      return Math.round(averageScore);
    }

    // 驻拽爪转 easing
    function easeOutQuart(x) {
      return 1 - Math.pow(1 - x, 4);
    }

    // 驻拽爪 驻砖转 住驻专
    function animateNumber(element, start, end, duration) {
      const startTime = performance.now();
      const range = end - start;

      function update() {
        const currentTime = performance.now();
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);

        // 砖 注专  注 easing
        const easedProgress = easeOutQuart(progress);
        const current = start + (range * easedProgress);
        
        element.textContent = Math.round(current);

        if (progress < 1) {
          requestAnimationFrame(update);
        }
      }

      requestAnimationFrame(update);
    }

    // 驻拽爪 专转 转专 爪
    function getScoreDescription(score) {
      if (score >= 90) return 'Perfect';
      if (score >= 85) return 'Wonderful';
      if (score >= 75) return 'Great';
      if (score >= 65) return 'Good';
      if (score >= 55) return 'Fair';
      return 'Poor';
    }

    // 驻拽爪 专转  砖转砖 砖爪 驻转
    function getPercentageComparison(score) {
      // 爪   砖 砖爪 驻转
      return {
        isHigher: score >= 50,
        percentage: score
      };
    }

    // 爪专转  砖爪 转 爪 爪注
    function createAverageScoreElement(score) {
      const averageDiv = document.createElement('div');
      averageDiv.className = 'average-score';
      const comparison = getPercentageComparison(score);
      averageDiv.innerHTML = `
        <h3>Your Result</h3>
        <div class="score-circle">
          <span class="big-score">1</span>
          <span class="of-100">of 100</span>
        </div>
        <div class="score-description">${getScoreDescription(score)}</div>
        <p class="score-comparison">${comparison.isHigher ? 
          `You scored higher than ${100 - comparison.percentage}% of the people who have taken these tests` :
          `You scored lower than ${comparison.percentage}% of the people who have taken these tests`
        }</p>
      `;

      // 驻注 转 爪 专 砖 住祝 -DOM
      setTimeout(() => {
        const scoreElement = averageDiv.querySelector('.big-score');
        animateNumber(scoreElement, 1, score, 2500); // 爪 砖 2.5 砖转
      }, 100);

      return averageDiv;
    }

    // 驻拽爪 专砖转 砖专爪 
    async function loadAndDisplayResults() {
      try {
        console.log('转转 注转 转...');
        
        // 注转 转 拽抓 JSON
        const response = await fetch('data.json');
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        console.log('转 注:', data);

        // 砖 爪 爪注
        const averageScore = calculateAverageScore(data);
        console.log('爪 爪注:', averageScore);

        // 爪 转  砖 转 转爪转
        const container = document.getElementById('summary-container');
        if (!container) {
          throw new Error(' 爪  summary-container');
        }

        // 拽 转  驻 住驻转 转 砖
        container.innerHTML = '';

        // 住祝 转 爪 爪注
        container.appendChild(createAverageScoreElement(averageScore));

        // 爪专转  驻专
        const summaryItemsContainer = document.createElement('div');
        summaryItemsContainer.className = 'summary-items-container';

        // 住驻转 转专转 Summary
        const summaryTitle = document.createElement('h2');
        summaryTitle.className = 'summary-title';
        summaryTitle.textContent = 'Summary';
        summaryItemsContainer.appendChild(summaryTitle);

        // 住祝 转  驻专
        data.forEach((item, index) => {
          console.log(`注 驻专 ${index}:`, item);
          const resultItem = createResultItem(item);
          summaryItemsContainer.appendChild(resultItem);
        });

        // 住祝 驻转专 Continue
        const continueButton = document.createElement('button');
        continueButton.className = 'continue-button';
        continueButton.textContent = 'Continue';
        summaryItemsContainer.appendChild(continueButton);

        // 住祝 转  转  专砖
        container.appendChild(summaryItemsContainer);

        console.log(' 驻专 住驻 爪!');

      } catch (error) {
        console.error('转驻住 砖:', error);
        showError(error.message);
      }
    }

    // 驻注 转 拽 砖祝 注
    document.addEventListener('DOMContentLoaded', loadAndDisplayResults);
  </script>
</body>
</html>